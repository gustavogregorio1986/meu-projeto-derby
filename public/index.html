<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Blog DerbyJS</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
  <div class="container py-4">
    <h1 class="mb-4 text-center">ðŸ“– Blog DerbyJS</h1>

    <!-- Criar autor -->
    <div class="card mb-4 shadow-sm">
      <div class="card-header bg-primary text-white">Criar Autor</div>
      <div class="card-body">
        <form id="form-author" class="row g-3">
          <div class="col-md-6">
            <label class="form-label">Nome</label>
            <input type="text" id="author-name" class="form-control" required>
          </div>
          <div class="col-md-6">
            <label class="form-label">Email</label>
            <input type="email" id="author-email" class="form-control" required>
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-success">Salvar Autor</button>
          </div>
        </form>
        <div id="author-result" class="mt-2 text-success"></div>
      </div>
    </div>

    <!-- Criar post -->
    <div class="card mb-4 shadow-sm">
      <div class="card-header bg-secondary text-white">Criar Post</div>
      <div class="card-body">
        <form id="form-post" class="row g-3">
          <div class="col-md-4">
            <label class="form-label">Autor</label>
           <select id="post-authorId" class="form-select" required>
              <option value="">Selecione um autor...</option>
           </select>
          </div>
          <div class="col-md-8">
            <label class="form-label">TÃ­tulo</label>
            <input type="text" id="post-title" class="form-control" required>
          </div>
          <div class="col-12">
            <label class="form-label">ConteÃºdo</label>
            <textarea id="post-content" class="form-control" rows="3" required></textarea>
          </div>
          <div class="col-12">
            <button type="submit" class="btn btn-primary">Salvar Post</button>
          </div>
        </form>
        <div id="post-result" class="mt-2 text-info"></div>
      </div>
    </div>

    <!-- Listar posts -->
    <div class="card shadow-sm">
      <div class="card-header bg-dark text-white">Posts</div>
      <div class="card-body">
        <form id="form-filter" class="row g-3 mb-3">
          <div class="col-md-6">
            <label class="form-label">Filtrar por autorId</label>
            <input type="number" id="filter-authorId" class="form-control">
          </div>
          <div class="col-md-6 d-flex align-items-end">
            <button type="submit" class="btn btn-outline-primary me-2">Buscar</button>
            <button type="button" id="clear-filter" class="btn btn-outline-secondary">Limpar</button>
          </div>
        </form>
        <div id="posts" class="row gy-3"></div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    const API = '/api';

    // Criar autor
    document.getElementById('form-author').addEventListener('submit', async (e) => {
      e.preventDefault();
      const name = document.getElementById('author-name').value;
      const email = document.getElementById('author-email').value;

      const res = await fetch(`${API}/authors`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ name, email })
      });
      const data = await res.json();
      document.getElementById('author-result').textContent =
        res.ok ? `Autor criado: ID ${data.id} - ${data.name}` : `Erro: ${data.error}`;
       document.getElementById('form-author').reset();
      document.getElementById('form-post').reset();
      loadAuthors(); // atualiza select
    });

    // Criar post
    document.getElementById('form-post').addEventListener('submit', async (e) => {
      e.preventDefault();
      const authorId = Number(document.getElementById('post-authorId').value);
      const title = document.getElementById('post-title').value;
      const content = document.getElementById('post-content').value;

      const res = await fetch(`${API}/posts`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ authorId, title, content })
      });
      const data = await res.json();
      document.getElementById('post-result').textContent =
        res.ok ? `Post criado: ID ${data.id} - ${data.title}` : `Erro: ${data.error}`;
      fetchPosts(); // atualiza lista
    });

    // Listar posts
    async function fetchPosts(authorId) {
      const url = authorId ? `${API}/posts?authorId=${authorId}` : `${API}/posts`;
      const res = await fetch(url);
      const data = await res.json();
      const container = document.getElementById('posts');
      container.innerHTML = '';
      if (!data.length) {
        container.innerHTML = '<p class="text-muted">Nenhum post encontrado.</p>';
        return;
      }
      data.forEach(p => {
        const div = document.createElement('div');
        div.className = 'col-12 col-md-6';
        div.innerHTML = `
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title">${p.title}</h5>
              <h6 class="card-subtitle mb-2 text-muted">Autor: ${p.authorId}</h6>
              <p class="card-text">${p.content}</p>
            </div>
          </div>`;
        container.appendChild(div);
      });
    }

    async function loadAuthors() {
  const res = await fetch(`${API}/authors`);
  const data = await res.json();
  const select = document.getElementById('post-authorId');
  select.innerHTML = '<option value="">Selecione um autor...</option>';
  data.forEach(author => {
    const opt = document.createElement('option');
    opt.value = author.id; // usa o ID numÃ©rico
    opt.textContent = `${author.name} (ID: ${author.id})`;
    select.appendChild(opt);
  });
}

    // Filtro
    document.getElementById('form-filter').addEventListener('submit', async (e) => {
      e.preventDefault();
      const authorId = Number(document.getElementById('filter-authorId').value);
      await fetchPosts(authorId || undefined);
    });

    document.getElementById('clear-filter').addEventListener('click', async () => {
      document.getElementById('filter-authorId').value = '';
      await fetchPosts();
    });

    // Inicial
    fetchPosts();
    loadAuthors();
  </script>
</body>
</html>